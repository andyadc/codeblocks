<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Upload Native</title>

	<script src="/jquery/jquery-1.12.3.min.js"></script>

	<style>
		.form-container {
			max-width: 500px;
			margin: 20px auto;
			padding: 20px;
			border: 1px solid #ddd;
			border-radius: 5px;
		}

		.form-group {
			margin-bottom: 15px;
		}

		.progress {
			height: 20px;
			margin-bottom: 20px;
			overflow: hidden;
			background-color: #f5f5f5;
			border-radius: 4px;
			box-shadow: inset 0 1px 2px rgba(0, 0, 0, .1);
			display: none;
		}

		.progress-bar {
			float: left;
			width: 0;
			height: 100%;
			font-size: 12px;
			line-height: 20px;
			color: #fff;
			text-align: center;
			background-color: #337ab7;
			transition: width .6s ease;
		}
	</style>

</head>

<body>
<div class="form-container">
	<h2>文件上传表单</h2>
	<form enctype="multipart/form-data" id="uploadForm">
		<div class="form-group">
			<label for="name">姓名:</label>
			<input class="form-control" id="name" name="name" required type="text">
		</div>
		<div class="form-group">
			<label for="email">邮箱:</label>
			<input class="form-control" id="email" name="email" required type="email">
		</div>
		<div class="form-group">
			<label for="file">选择文件:</label>
			<input class="form-control" id="file" name="file" required type="file">
		</div>
		<div class="progress">
			<div class="progress-bar" role="progressbar"></div>
		</div>
		<button class="btn btn-primary" type="submit">提交</button>
	</form>
	<div id="responseMessage" style="margin-top: 15px;"></div>
</div>

<script>
	$(document).ready(function () {
		$('#uploadForm').submit(function (e) {
			e.preventDefault();

			var formData = new FormData(this);

			// 显示进度条
			$('.progress').show();

			$.ajax({
				url: '/upload',
				type: 'POST',
				data: formData,
				processData: false,
				contentType: false,
				xhr: function () {
					var xhr = new XMLHttpRequest();
					xhr.upload.addEventListener('progress', function (e) {
						if (e.lengthComputable) {
							var percent = Math.round((e.loaded / e.total) * 100);
							$('.progress-bar').css('width', percent + '%').text(percent + '%');
						}
					}, false);
					return xhr;
				},
				success: function (response) {
					$('#responseMessage').html('<div class="alert alert-success">' + response.message + '</div>');
					$('.progress').hide();
					$('#uploadForm')[0].reset();
				},
				error: function (xhr, status, error) {
					var errorMessage = xhr.responseJSON ? xhr.responseJSON.message : '上传失败';
					$('#responseMessage').html('<div class="alert alert-danger">' + errorMessage + '</div>');
					$('.progress').hide();
				}
			});
		});
	});
</script>

</body>
</html>
